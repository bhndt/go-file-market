stateDiagram-v2
	state "StorageDealUnknown" as 0
	state "StorageDealStaged" as 4
	state "StorageDealSealing" as 5
	state "StorageDealFinalizing" as 6
	state "StorageDealActive" as 7
	state "StorageDealExpired" as 8
	state "StorageDealSlashed" as 9
	state "StorageDealRejecting" as 10
	state "StorageDealFailing" as 11
	state "StorageDealValidating" as 14
	state "StorageDealAcceptWait" as 15
	state "StorageDealTransferring" as 17
	state "StorageDealWaitingForData" as 19
	state "StorageDealVerifyData" as 20
	state "StorageDealEnsureProviderFunds" as 21
	state "StorageDealProviderFunding" as 23
	state "StorageDealPublish" as 25
	state "StorageDealPublishing" as 26
	state "StorageDealError" as 27
	4 : On entry runs HandoffDeal
	5 : On entry runs VerifyDealActivated
	6 : On entry runs CleanupDeal
	7 : On entry runs WaitForDealCompletion
	10 : On entry runs RejectDeal
	11 : On entry runs FailDeal
	14 : On entry runs ValidateDealProposal
	15 : On entry runs DecideOnProposal
	20 : On entry runs VerifyData
	21 : On entry runs EnsureProviderFunds
	23 : On entry runs WaitForFunding
	25 : On entry runs PublishDeal
	26 : On entry runs WaitForPublish
	[*] --> 0
	note right of 0
		The following events are not shown cause they can trigger from any state.

		ProviderEventNodeErrored - transitions state to StorageDealFailing
		ProviderEventRestart - does not transition state
	end note
	0 --> 14 : ProviderEventOpen
	14 --> 10 : ProviderEventDealRejected
	15 --> 10 : ProviderEventDealRejected
	20 --> 10 : ProviderEventDealRejected
	10 --> 11 : ProviderEventRejectionSent
	14 --> 15 : ProviderEventDealDeciding
	15 --> 19 : ProviderEventDataRequested
	17 --> 11 : ProviderEventDataTransferFailed
	19 --> 17 : ProviderEventDataTransferInitiated
	19 --> 17 : ProviderEventDataTransferRestarted
	17 --> 20 : ProviderEventDataTransferCompleted
	20 --> 11 : ProviderEventDataVerificationFailed
	19 --> 21 : ProviderEventVerifiedData
	20 --> 21 : ProviderEventVerifiedData
	21 --> 23 : ProviderEventFundingInitiated
	21 --> 25 : ProviderEventFunded
	23 --> 25 : ProviderEventFunded
	25 --> 26 : ProviderEventDealPublishInitiated
	26 --> 11 : ProviderEventDealPublishError
	10 --> 11 : ProviderEventSendResponseFailed
	15 --> 11 : ProviderEventSendResponseFailed
	26 --> 4 : ProviderEventDealPublished
	4 --> 11 : ProviderEventFileStoreErrored
	5 --> 11 : ProviderEventFileStoreErrored
	7 --> 11 : ProviderEventFileStoreErrored
	4 --> 11 : ProviderEventMultistoreErrored
	4 --> 11 : ProviderEventDealHandoffFailed
	4 --> 5 : ProviderEventDealHandedOff
	5 --> 11 : ProviderEventDealActivationFailed
	5 --> 6 : ProviderEventDealActivated
	6 --> 7 : ProviderEventCleanupFinished
	7 --> 9 : ProviderEventDealSlashed
	7 --> 8 : ProviderEventDealExpired
	7 --> 27 : ProviderEventDealCompletionFailed
	11 --> 27 : ProviderEventFailed
	10 --> 27 : ProviderEventRestart
	14 --> 27 : ProviderEventRestart
	15 --> 27 : ProviderEventRestart
	21 --> 11 : ProviderEventTrackFundsFailed

	note left of 4 : The following events only record in this state.<br><br>ProviderEventPieceStoreErrored


	note left of 11 : The following events only record in this state.<br><br>ProviderEventFundsReleased


	note left of 17 : The following events only record in this state.<br><br>ProviderEventDataTransferRestarted


	note left of 21 : The following events only record in this state.<br><br>ProviderEventFundsReserved


	note left of 26 : The following events only record in this state.<br><br>ProviderEventFundsReleased

	27 --> [*]
	9 --> [*]
	8 --> [*]
